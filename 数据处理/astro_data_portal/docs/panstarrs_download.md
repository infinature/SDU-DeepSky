# Pan-STARRS 数据下载功能说明

## 功能概述

Pan-STARRS（全景巡天望远镜和快速响应系统）数据下载功能允许用户下载多波段的天文图像数据。该功能支持以下特性：

- 支持单个目标或批量目标下载
- 多波段图像下载（g, r, i, z, y）
- 支持 Matplotlib 和 DS9 两种可视化方式
- 实时下载进度显示
- 下载历史记录

## 使用方法

### 1. 添加目标

有两种方式可以添加下载目标：

#### 1.1 CSV 文件上传

1. 准备一个包含以下列的 CSV 文件：
   - `id`: 目标标识符
   - `ra`: 赤经（度）
   - `dec`: 赤纬（度）

2. 点击"选择文件"按钮上传 CSV 文件
3. 系统会自动解析文件并显示导入结果

#### 1.2 手动输入

1. 在表单中填写以下信息：
   - Object ID：目标标识符
   - Right Ascension：赤经（0-360度）
   - Declination：赤纬（-90到90度）
2. 点击"Add Target"按钮添加目标

### 2. 设置下载选项

#### 2.1 波段选择

可选择以下波段：
- g band (4686 Å)：绿色波段
- r band (6166 Å)：红色波段
- i band (7480 Å)：近红外波段
- z band (8932 Å)：红外波段
- y band (9633 Å)：远红外波段

#### 2.2 图像大小

- 可设置图像大小（像素）
- 范围：100-1000像素
- 默认值：240像素

#### 2.3 可视化方式

两种可视化选项：

1. Matplotlib
   - 适合快速预览
   - 不需要额外软件
   - 生成 PNG 格式图像

2. DS9
   - 提供更专业的图像处理功能
   - 需要安装 SAOImage DS9 软件
   - 生成更高质量的图像

#### 2.4 保存目录

- 可自定义保存目录
- 默认保存在 `panstarrs_downloads` 目录下
- 支持通过文件选择器选择目录

### 3. 下载过程

1. 点击"开始下载"按钮启动下载
2. 系统会显示实时下载进度
3. 下载完成后会显示通知
4. 可以在"下载历史"中查看所有下载记录

### 4. 输出文件

下载完成后，在指定的保存目录中会生成以下文件：

- `fits_files/`：原始 FITS 文件
- `images/`：生成的图像文件
  - 单波段图像
  - RGB 合成图像
- `ds9_images/`：DS9 生成的图像（如果选择 DS9 可视化）
- `fits_headers/`：FITS 文件头信息

## 注意事项

1. CSV 文件格式要求：
   - 必须包含 id, ra, dec 三列
   - 列名不区分大小写
   - 坐标值必须是有效的数字

2. DS9 路径设置：
   - Windows: `C:\Program Files\SAOImageDS9\ds9.exe`
   - Linux: `/usr/bin/ds9`
   - macOS: `/Applications/SAOImageDS9.app/Contents/MacOS/ds9`

3. 下载限制：
   - 图像大小限制在 100-1000 像素之间
   - 必须至少选择一个波段
   - 必须至少添加一个目标

## 错误处理

1. CSV 文件错误：
   - 显示具体的错误信息
   - 指出缺少的必需列
   - 提示无效的坐标值

2. 下载错误：
   - 显示具体的错误信息
   - 在下载历史中标记失败状态
   - 提供重试选项

## 技术实现

### 前端实现

- 使用 Vue 3 和 Quasar 框架
- 响应式表单验证
- 实时状态更新
- 文件上传和解析
- 进度显示和错误处理

### 后端实现

- 使用 Flask 框架
- 异步任务处理
- 多波段图像下载
- FITS 文件处理
- 图像生成和合成

## 常见问题

1. 下载速度慢
   - 检查网络连接
   - 减少同时下载的波段数量
   - 减小图像大小

2. 图像质量不理想
   - 尝试使用 DS9 可视化方式
   - 调整图像大小
   - 检查波段组合

3. DS9 路径错误
   - 确认 DS9 已正确安装
   - 检查路径是否正确
   - 使用文件选择器选择正确的路径 